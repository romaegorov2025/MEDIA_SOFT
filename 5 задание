5 ЗАДАНИЕ

1. Вывести покупателей с количеством осуществленных покупок:
SELECT
  p.Имя,
  p.Фамилия,
  COUNT(pok.Идентификатор) AS Количество_покупок
FROM Покупатели p
LEFT JOIN Покупки pok
  ON p.Идентификатор = pok.Ключ_покупателя
GROUP BY
  p.Имя,
  p.Фамилия;


Разъяснение:
•   FROM Покупатели p: Выбираем данные из таблицы "Покупатели", давая ей псевдоним "p".
•   LEFT JOIN Покупки pok ON p.Идентификатор = pok.Ключ_покупателя: Присоединяем таблицу "Покупки" к таблице "Покупатели" по идентификаторам покупателя (связь один-ко-многим), используя LEFT JOIN для включения всех покупателей, даже если у них нет покупок.
•   COUNT(pok.Идентификатор) AS Количество_покупок: Считаем количество покупок для каждого покупателя.
•   GROUP BY p.Имя, p.Фамилия: Группируем результаты по имени и фамилии покупателя.

2. Общую стоимость товаров для каждого покупателя и отсортировать результат в порядке убывания:
SELECT
  p.Имя,
  p.Фамилия,
  SUM(t.Стоимость) AS Общая_стоимость
FROM Покупатели p
JOIN Покупки pok
  ON p.Идентификатор = pok.Ключ_покупателя
JOIN Товары t
  ON pok.Ключ_товара = t.Идентификатор
GROUP BY
  p.Имя,
  p.Фамилия
ORDER BY
  Общая_стоимость DESC;


Разъяснение:
•   FROM Покупатели p JOIN Покупки pok ON p.Идентификатор = pok.Ключ_покупателя JOIN Товары t ON pok.Ключ_товара = t.Идентификатор: Объединяем таблицы "Покупатели", "Покупки" и "Товары" по соответствующим ключам.
•   SUM(t.Стоимость) AS Общая_стоимость: Вычисляем общую стоимость товаров для каждого покупателя.
•   GROUP BY p.Имя, p.Фамилия: Группируем результаты по имени и фамилии покупателя.
•   ORDER BY Общая_стоимость DESC: Сортируем результаты в порядке убывания общей стоимости.

3. Получить покупателей, купивших только один товар:
SELECT
  p.Имя,
  p.Фамилия
FROM Покупатели p
JOIN Покупки pok
  ON p.Идентификатор = pok.Ключ_покупателя
GROUP BY
  p.Имя,
  p.Фамилия
HAVING
  COUNT(pok.Ключ_товара) = 1;


Разъяснение:
•   FROM Покупатели p JOIN Покупки pok ON p.Идентификатор = pok.Ключ_покупателя: Объединяем таблицы "Покупатели" и "Покупки".
•   GROUP BY p.Имя, p.Фамилия: Группируем результаты по имени и фамилии покупателя.
•   HAVING COUNT(pok.Ключ_товара) = 1: Фильтруем группы, выбирая только те, у которых количество уникальных товаров равно 1.
